{"componentChunkName":"component---src-templates-blog-template-tsx","path":"/blog/Frontend/graphql-and-react-apollo","result":{"data":{"markdownRemark":{"html":"<h1 id=\"一-引言\" style=\"position:relative;\"><a href=\"#%E4%B8%80-%E5%BC%95%E8%A8%80\" aria-label=\"一 引言 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>(一) 引言</h1>\n<p>提到 GraphQL 與 React Apollo ，這個在 Web 前端被廣泛討論的技術名詞，究竟他們兩個是甚麼呢？</p>\n<p>由於這兩個技術名詞，會涉及前後端的串接 [註一]，在介紹這兩個技術名詞之前，先提一下以往在串接前後端的做法。時至 2020 年的今日，姑且稱呼在這年之前的歷史發展，都叫「以往」吧。</p>\n<p>提到 GraphQL 與 React Apollo ，這個在 Web 前端被廣泛討論的技術名詞，究竟他們兩個是甚麼呢？</p>\n<p>由於這兩個技術名詞，會涉及前後端的串接 [註一]，在介紹這兩個技術名詞之前，先提一下以往在串接前後端的做法。時至 2020 年的今日，姑且稱呼在這年之前的歷史發展，都叫「以往」吧。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/743f26eb936122c6428bd553a90ad704/2cefc/image0.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 16.56441717791411%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsSAAALEgHS3X78AAAAjElEQVQI12NggAIBLU9GKC0GxJECut4B4gwMHAzP/wsxXP+by3D9Xx/Di/+K/xkaOB6ZrQl7arLaGYjNQXqANCMDOhDQ8oDRAkBsLaDjZSEsoMvJ8P8/C9BAP6CBqQzP/vP/Z5BhfGy2xgFoiC8QS+E0EOo6mKEsAhpuzHCJN/8ZGO79R9EENIQNm2EAcdYx7iS1tI8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image\"\n        title=\"image\"\n        src=\"/static/743f26eb936122c6428bd553a90ad704/a6d36/image0.png\"\n        srcset=\"/static/743f26eb936122c6428bd553a90ad704/222b7/image0.png 163w,\n/static/743f26eb936122c6428bd553a90ad704/ff46a/image0.png 325w,\n/static/743f26eb936122c6428bd553a90ad704/a6d36/image0.png 650w,\n/static/743f26eb936122c6428bd553a90ad704/e548f/image0.png 975w,\n/static/743f26eb936122c6428bd553a90ad704/3c492/image0.png 1300w,\n/static/743f26eb936122c6428bd553a90ad704/2cefc/image0.png 1400w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<!--more-->\n<hr>\n<h2 id=\"早期：-xmlhttprequest\" style=\"position:relative;\"><a href=\"#%E6%97%A9%E6%9C%9F%EF%BC%9A-xmlhttprequest\" aria-label=\"早期： xmlhttprequest permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>早期： XMLHttpRequest()</h2>\n<p>範例比如<a href=\"https://gist.github.com/EtienneR/2f3ab345df502bd3d13e\">這裡</a>，在 JavaScript Promise 語法出來之前，使用這種方式非同步的從後端取得資料，前端可以再搭配 callback 處理這些非同步的資料。</p>\n<h2 id=\"中期：-fetch-api\" style=\"position:relative;\"><a href=\"#%E4%B8%AD%E6%9C%9F%EF%BC%9A-fetch-api\" aria-label=\"中期： fetch api permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>中期： Fetch API</h2>\n<p>遇到非同步程式碼，若只能使用 Callback 往往不利閱讀與維護。\n在 JavaScript Promise 語法出來後，官方推出 <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch\">Fetch</a>，前端可使用 chain 的方式，發送 HTTP request 取得資料。另外有部分開發者仍覺得有些不好用的地方，開發了 <a href=\"https://github.com/axios/axios\">Axios</a>、<a href=\"https://visionmedia.github.io/superagent/\">SuperAgent</a> 等函式庫。以下文章統稱為 Fetch API。</p>\n<h2 id=\"近期：-2013-年-facebook-首次推出-react-後\" style=\"position:relative;\"><a href=\"#%E8%BF%91%E6%9C%9F%EF%BC%9A-2013-%E5%B9%B4-facebook-%E9%A6%96%E6%AC%A1%E6%8E%A8%E5%87%BA-react-%E5%BE%8C\" aria-label=\"近期： 2013 年 facebook 首次推出 react 後 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>近期： 2013 年 Facebook 首次推出 React 後</h2>\n<p>為了能搭配 React 這個 UI 函式庫，更方便使用 Fetch API，開發者們會將不同的階段，如等待結果中、資料正確取回、發生錯誤等等，用不同 React State 記錄，再自行封裝在 class component，或是 Hook 中，方便使用。</p>\n<h2 id=\"最近：2015-年-redux-推出-react-redux\" style=\"position:relative;\"><a href=\"#%E6%9C%80%E8%BF%91%EF%BC%9A2015-%E5%B9%B4-redux-%E6%8E%A8%E5%87%BA-react-redux\" aria-label=\"最近：2015 年 redux 推出 react redux permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>最近：2015 年 Redux 推出 react-redux</h2>\n<p>為了讓 React 更好的管理並記錄狀態，在 React 推出 Context API 前，Redux 團隊先推出了 react-redux，讓 React 透過 Redux 的狀態管理，能跨 Component 間分享狀態。</p>\n<p>這時，開發人員又覺得，我們別將取資料跟 Component 混雜在一起，把非同步取資料的程式碼統一寫在進 Reducer 之前，再讓 Reducer 寫入資料到 Store，不是很好嗎？[註二]</p>\n<p>在這樣的概念下，不同團隊各開發了不同的 Middleware 比如 redux-thunk, redux-saga, redux-observable，用來處理非同步的程式碼。\n其中 <a href=\"https://redux-observable.js.org/\">redux-observable</a> 紅極一時，可以讓 Redux 搭配 RxJS 使用，而 RxJS 號稱是非同步程式碼的 Lodash [註三]。</p>\n<h2 id=\"but-\" style=\"position:relative;\"><a href=\"#but-\" aria-label=\"but  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>But ...</h2>\n<p>寫起來實在是很多行，以 redux-observable 為例，要寫 Action, Action-Creator, Fetch API, Epic, Reducer 才能達成串接並寫入資料 Store，寫起來行數其實挺多的。</p>\n<p>redux-observable 能針對特殊的狀況，比如<a href=\"https://www.youtube.com/watch?v=sF5-V-Szo0c&#x26;feature=youtu.be&#x26;t=566\">取消網路請求</a>，能漂亮且有效處理。大部分情況下，取個資料顯示在前端，或是使用者操作，送個資料回後端，其實並不複雜。</p>\n<p>有沒有辦法，在大部分的情況下讓程式碼行數減少，更有效率的開發呢？</p>\n<hr>\n<h1 id=\"二-介紹\" style=\"position:relative;\"><a href=\"#%E4%BA%8C-%E4%BB%8B%E7%B4%B9\" aria-label=\"二 介紹 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>(二) 介紹</h1>\n<h2 id=\"什麼是-graphql？\" style=\"position:relative;\"><a href=\"#%E4%BB%80%E9%BA%BC%E6%98%AF-graphql%EF%BC%9F\" aria-label=\"什麼是 graphql？ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>什麼是 GraphQL？</h2>\n<p>從<a href=\"https://graphql.org/\">官方</a>的定義來看</p>\n<p>\"GraphQL is a query language for APIs and a runtime for fulfilling those queries with your existing data.\"</p>\n<ol>\n<li>GraphQL 是<strong>新的查詢語言</strong>，為了詢問 API 而生。</li>\n<li>GraphQL 是能<strong>與既存資料互動的執行環境</strong>，為了滿足新的查詢語言。</li>\n</ol>\n<h2 id=\"新的查詢語言--使用宣告式語法\" style=\"position:relative;\"><a href=\"#%E6%96%B0%E7%9A%84%E6%9F%A5%E8%A9%A2%E8%AA%9E%E8%A8%80--%E4%BD%BF%E7%94%A8%E5%AE%A3%E5%91%8A%E5%BC%8F%E8%AA%9E%E6%B3%95\" aria-label=\"新的查詢語言  使用宣告式語法 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>新的查詢語言 — 使用宣告式語法</h2>\n<p>GraphQL 提供宣告式的、類似物件的語法，得到自己想查詢的資料\n如下例，左邊是我們宣告的內容，描述希望取到什麼資料，右邊是 server 回傳值。關於語法如何使用，可參考<a href=\"https://graphql.org/learn/\">這</a></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f783b51521863ae15351c98483579292/2bef9/image1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 44.171779141104295%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsSAAALEgHS3X78AAABPUlEQVQoz22Qi26CQBBF/f9fa2yjRqGIUnnILiy7y+yTh9jBalKjk5ubDNkzd5hFmqZlSWrGqqrGYoyhCyElgKSUH44NQMN507zRQt9qmqbra1krD4lgUjRCWausQ+mblLHKuAXnXGtluyE8c8rb678pk7U2ywnGp0SA0spo42YH8zdihr33+HSX8+WRPrh7sjlldhzjM9ufWftTyX0JhLeEY/Id7roOXyrXo57Wx+S0AOco47i3arUSoBHz/inZOXe5XF7/2aS5G4Yor6KCQULFNgPk3QM2xgzDMI7j24PZrODaSMCj9A7lb971dxhPLaVUSgEADsJ2dmy1HvBTcpK4pzG0qgtCSFXTmpW0wu1nGMkwDIMgiKIoSZI4jtGxXW02siS+KHXft6C2Qfix/FytN7vw+2u1Fi0Y538B/0n9BGIxkjQAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image\"\n        title=\"image\"\n        src=\"/static/f783b51521863ae15351c98483579292/a6d36/image1.png\"\n        srcset=\"/static/f783b51521863ae15351c98483579292/222b7/image1.png 163w,\n/static/f783b51521863ae15351c98483579292/ff46a/image1.png 325w,\n/static/f783b51521863ae15351c98483579292/a6d36/image1.png 650w,\n/static/f783b51521863ae15351c98483579292/e548f/image1.png 975w,\n/static/f783b51521863ae15351c98483579292/2bef9/image1.png 1024w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2 id=\"與既存資料互動的執行環境\" style=\"position:relative;\"><a href=\"#%E8%88%87%E6%97%A2%E5%AD%98%E8%B3%87%E6%96%99%E4%BA%92%E5%8B%95%E7%9A%84%E5%9F%B7%E8%A1%8C%E7%92%B0%E5%A2%83\" aria-label=\"與既存資料互動的執行環境 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>與既存資料互動的執行環境</h2>\n<p>GraphQL 提供函式庫，讓我們能完成支援 GraphQL 查詢語法的 server。這個 server 常被當成是中介的 server：前端先與 GraphQL server 取資料， GraphQL server 再發送 HTTP request 向資料庫取資料，這種做法也被稱為 \"GraphQL as an API Gateway\"。</p>\n<p>GraphQL server 經由函式庫將來源資料，轉換成帶上原型的 instance 後，前端就能使用上述宣告式的語法，取值或是送值回 server。</p>\n<p>關於如何使用 Node Express 架出 GraphQL server 、如何轉換來源資料，可參考<a href=\"https://github.com/andy770921/graphQL-demo\">這個 Demo Repo</a> 或是<a href=\"https://github.com/iamshaunjp/graphql-playlist/tree/lesson-36\">這個 Demo Repo</a>，server 資料夾下的程式碼。將靜態的 JavaScript 陣列 [註四]，轉成可供 GraphQL 宣告式語法查詢的資料。</p>\n<h2 id=\"什麼是-react-apollo？\" style=\"position:relative;\"><a href=\"#%E4%BB%80%E9%BA%BC%E6%98%AF-react-apollo%EF%BC%9F\" aria-label=\"什麼是 react apollo？ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>什麼是 React Apollo？</h2>\n<p>從<a href=\"https://github.com/apollographql/react-apollo\">官方</a>的定義來看</p>\n<p>\"React Apollo allows you to fetch data from your GraphQL server and use it in building complex and reactive UIs using the React framework.\"</p>\n<p>React Apollo 是<strong>在 React 框架下，可以讓我們從 GraphQL server 取資料的函式庫</strong>，官方提供了可以適用不同情境的 React Hook ，讓我們可以依照不同情境使用。</p>\n<h2 id=\"為什麼要用-graphql--react-apollo？\" style=\"position:relative;\"><a href=\"#%E7%82%BA%E4%BB%80%E9%BA%BC%E8%A6%81%E7%94%A8-graphql--react-apollo%EF%BC%9F\" aria-label=\"為什麼要用 graphql  react apollo？ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>為什麼要用 GraphQL / React Apollo？</h2>\n<p>GraphQL / React Apollo 主要解決了三大問題。</p>\n<h3 id=\"一、串接後端從多個-endpoint-變一個\" style=\"position:relative;\"><a href=\"#%E4%B8%80%E3%80%81%E4%B8%B2%E6%8E%A5%E5%BE%8C%E7%AB%AF%E5%BE%9E%E5%A4%9A%E5%80%8B-endpoint-%E8%AE%8A%E4%B8%80%E5%80%8B\" aria-label=\"一、串接後端從多個 endpoint 變一個 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>一、串接後端從多個 Endpoint 變一個</h3>\n<p>以書籍、作者的頁面當例子，如果希望畫面呈現某本書及詳細的細節，及推薦作者寫的其他書，在使用 REST API 時，我們可能會先發送請求，用某書籍 ID，到書籍路徑下的 Endpoint ，取到書籍詳細資料與作者。</p>\n<p><code>domain.com/book/:id</code></p>\n<p>等資料回來後，再用作者 ID 發送請求到另一個作者路徑下的 Endpoint ，取到該作者著作的所有書籍。</p>\n<p><code>domain.com/author/:id</code></p>\n<p>如果同個頁面，又要顯示顯示所有書籍的資料，我們又必須要再打以下 API。</p>\n<p><code>domain.com/books</code></p>\n<p>如果使用 GraphQL / React Apollo，我們只需要打同一個 Endpoint 就可以取得所有的資料。</p>\n<p><code>domain.com/graphql</code></p>\n<p>依照不同查詢情境，query string 會被自動處理好，取得我們想要的資料。</p>\n<h3 id=\"二、前端精準取得自己要的資料\" style=\"position:relative;\"><a href=\"#%E4%BA%8C%E3%80%81%E5%89%8D%E7%AB%AF%E7%B2%BE%E6%BA%96%E5%8F%96%E5%BE%97%E8%87%AA%E5%B7%B1%E8%A6%81%E7%9A%84%E8%B3%87%E6%96%99\" aria-label=\"二、前端精準取得自己要的資料 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>二、前端精準取得自己要的資料</h3>\n<p>依照使用情境，取的自己需要的資料即可，可以少取可以多取（巢狀取）。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ab5991e36a3d796010d75a6df4927461/339e3/image2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 36.19631901840491%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsSAAALEgHS3X78AAAAq0lEQVQY032QwQ6DIBBE+f/P8uQXmPTSQ4ktrbFSCtWFXbYaFDnYzgV2mLeZIHgTziKKXOhlOK6Gt/ZtrA8U4x4R6VisSJ0ZT22fAb4qJloDGM63wbhpvh7BHCFg+7T7bvVIcHLU4AY7ckGLvIaIAHzZmtW9hPUHLp0p3wX/0Q4vU0C0I/yEnXMAwDm+wQsZAsBEiAcflro1TSOlzD1L2Htf13VVVVrrFJj1BazAm8qKkZVjAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image\"\n        title=\"image\"\n        src=\"/static/ab5991e36a3d796010d75a6df4927461/a6d36/image2.png\"\n        srcset=\"/static/ab5991e36a3d796010d75a6df4927461/222b7/image2.png 163w,\n/static/ab5991e36a3d796010d75a6df4927461/ff46a/image2.png 325w,\n/static/ab5991e36a3d796010d75a6df4927461/a6d36/image2.png 650w,\n/static/ab5991e36a3d796010d75a6df4927461/e548f/image2.png 975w,\n/static/ab5991e36a3d796010d75a6df4927461/339e3/image2.png 977w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h3 id=\"三、處理非同步的複雜邏輯，不需要自己處理\" style=\"position:relative;\"><a href=\"#%E4%B8%89%E3%80%81%E8%99%95%E7%90%86%E9%9D%9E%E5%90%8C%E6%AD%A5%E7%9A%84%E8%A4%87%E9%9B%9C%E9%82%8F%E8%BC%AF%EF%BC%8C%E4%B8%8D%E9%9C%80%E8%A6%81%E8%87%AA%E5%B7%B1%E8%99%95%E7%90%86\" aria-label=\"三、處理非同步的複雜邏輯，不需要自己處理 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>三、處理非同步的複雜邏輯，不需要自己處理</h3>\n<p>相對於 redux-observable 的規範，要寫 Action, Action-Creator, Fetch API, Epic, Reducer 等等，React Apollo 只需要依照情境選用 Hook，程式碼量降低，在使用情境單純的情況，較易理解。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/cc9b7837afd5102cd3596ae31d22335f/218a4/image3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 34.355828220858896%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsSAAALEgHS3X78AAABWUlEQVQY0y1Qa0/CQBDk//8XE43RGI0PCAqUSMWj1yulPERpbQ/67pV7rSc62f0yk8nsbAcAIpolCYXw/bh5FR8T/WkDSw0PjAHnlQBeULZFx53LQ8y+MA8JiNboHbO0gX15hK/xzr73X26O5IHnsTbCIYWi2FaQf5DUOqOTa797nk0uM/tKNfmvWdcp97ts3qtJNw/s2J9+jy+3g4sU3aolgrrVoM1EcYy9wFmGcZJUNZNSSSk7wLIM9/ZONyX9w2pGN16Mng7uM3WeeGDMjCullSqLYmiNX6y31TJo21ae8Hv2P7I1nU+C6TD3+rLOTkwOZSW0Zox9R+E+K90N3Scmmwoh/sxaa6W11Ltp5dxV7qNY9qGhprM2nau6bGpnNhtZVrBYBL6HEMIYR1Fk8jvGajJW63V/YDlk8fqGbIQHw1FtXl1UUJQKQArh+z7GLvE8QkjTNOqEH867fu5SgZcGAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image\"\n        title=\"image\"\n        src=\"/static/cc9b7837afd5102cd3596ae31d22335f/a6d36/image3.png\"\n        srcset=\"/static/cc9b7837afd5102cd3596ae31d22335f/222b7/image3.png 163w,\n/static/cc9b7837afd5102cd3596ae31d22335f/ff46a/image3.png 325w,\n/static/cc9b7837afd5102cd3596ae31d22335f/a6d36/image3.png 650w,\n/static/cc9b7837afd5102cd3596ae31d22335f/e548f/image3.png 975w,\n/static/cc9b7837afd5102cd3596ae31d22335f/218a4/image3.png 1052w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<hr>\n<h1 id=\"三-實作\" style=\"position:relative;\"><a href=\"#%E4%B8%89-%E5%AF%A6%E4%BD%9C\" aria-label=\"三 實作 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>(三) 實作</h1>\n<h2 id=\"前置準備--graphql-server\" style=\"position:relative;\"><a href=\"#%E5%89%8D%E7%BD%AE%E6%BA%96%E5%82%99--graphql-server\" aria-label=\"前置準備  graphql server permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>前置準備 — GraphQL Server</h2>\n<p>如果要串接的後端，是第三方的服務，並且已經提供支援 GraphQL 的 Endpoint，如串接 <a href=\"https://developer.github.com/v4/\">GitHub</a>、<a href=\"https://docs.gitlab.com/ee/api/graphql/\">GitLab</a></p>\n<p>如果需要自己寫，可以透過 NodeJS 配合套件 express-graphql 實作，程式碼可簡單寫如下範例</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 472px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/47dc7a547081011ec95e4ef41990eb5d/3c5de/image4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 72.39263803680981%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsSAAALEgHS3X78AAABmklEQVQoz41TiW7jIBTMb9jc92XAxnbsOEe10m61//9FxU0jpepqlRECBIwG3gwHxigiDOQNhUy3Vc7TNPfnbVi3sgzxmvyWvDdGEGI4VZwjhOADB0YppqzJZ5vS+9twWfL1UnLfneZ0mmIXfCe5lzxpUax0WmFCIAAPMmOVDNKCbYDT2PiuZHe7jUMOUYq188WqrGWxmgvZtAA+YScjjKEwgEsgtZDCWmmM2tcRJAhRjGpP8A74HXcygdI10jTaasn63odguRB1Gzy1nziISma8ialPLicXOy+EatsWgH+e/07WSkHOm3m5rCV3jtb7EfxU0f+SlVJVwxv56xj/LOk4Rs75K7KfylpX61R14nY9vv+1zjJKXiVX5ToQysx89pffPCSgApQWgvYl5eqBc44Q+rVWX/zao3dlUnmUtm3ziM5uDYAI/LAKPPbuB/dqA0KaPPQlz8dhvc7DmLQywnol+D0eFGNG8GdgditEDTTZA3Ow1tZrm1zc6ebKNI2xBBuVqJGcnE5aBskHo+rciX3SKVF/S3S2lvkDZJlwuwH3VTgAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image\"\n        title=\"image\"\n        src=\"/static/47dc7a547081011ec95e4ef41990eb5d/3c5de/image4.png\"\n        srcset=\"/static/47dc7a547081011ec95e4ef41990eb5d/222b7/image4.png 163w,\n/static/47dc7a547081011ec95e4ef41990eb5d/ff46a/image4.png 325w,\n/static/47dc7a547081011ec95e4ef41990eb5d/3c5de/image4.png 472w\"\n        sizes=\"(max-width: 472px) 100vw, 472px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>schema 是從官方提供的函式庫 <code>new GraphQLSchema()</code> 產生出物件實例 ( instance )，可以依照自己需求，在 GraphQLSchema 帶入自定義的物件來設定，自行客製可供串接的 data 項目， schema 完整範例可參考<a href=\"https://github.com/andy770921/graphQL-demo/blob/master/server/schema/schema.js\">這裡的程式碼</a></p>\n<p>我們在上圖程式碼第 14 行有設定，<code>graphiql</code> 為 <code>true</code>，意思是前端可以直接在瀏覽器輸入網址如 <code>http://localhost:4000/graphql</code> ，連到 GraphQL 提供的網頁介面</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c6ff1536e5b21f07478c5fd8cbe4460c/024d6/image5.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 37.423312883435585%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsSAAALEgHS3X78AAAA8ElEQVQY02WQDW7DIAyFuf/RdoRNm9qlPwkBDBgIUAI1STdlmvWMhMz3bMOG4TJNXElJ2lICgNniddFaqr3+I9UVY2RUXULIpS65rOtaa22t9WwNvZeXSYxSO+eWpSv0E30XOTM+z2t5aJ/ePsdZYzsEeUulP76n6wyoLEqLCkndIiwUvXMphZ6+3+Gm/BEO/VG4S/M1gh2VOXMrtJUGfSA4GcOEEDRtzjk9aOx6hMkbnb/OahAaOegzR+tcjHtnohh9DJEhhH3bv3CktW9CnzjYCcyJo3GvzQmulRFGY/8nt7GDAOjrxUQNfUo79gs/AeUykZSIEtaMAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image\"\n        title=\"image\"\n        src=\"/static/c6ff1536e5b21f07478c5fd8cbe4460c/a6d36/image5.png\"\n        srcset=\"/static/c6ff1536e5b21f07478c5fd8cbe4460c/222b7/image5.png 163w,\n/static/c6ff1536e5b21f07478c5fd8cbe4460c/ff46a/image5.png 325w,\n/static/c6ff1536e5b21f07478c5fd8cbe4460c/a6d36/image5.png 650w,\n/static/c6ff1536e5b21f07478c5fd8cbe4460c/024d6/image5.png 961w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>可以先測試看看查詢語法是否正確、有哪些資料可以取、是否真的可以取得的資料等等</p>\n<h2 id=\"使用-react-apollo-三步驟\" style=\"position:relative;\"><a href=\"#%E4%BD%BF%E7%94%A8-react-apollo-%E4%B8%89%E6%AD%A5%E9%A9%9F\" aria-label=\"使用 react apollo 三步驟 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>使用 React Apollo 三步驟</h2>\n<h3 id=\"一、建立-apollo-client\" style=\"position:relative;\"><a href=\"#%E4%B8%80%E3%80%81%E5%BB%BA%E7%AB%8B-apollo-client\" aria-label=\"一、建立 apollo client permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>一、建立 Apollo Client</h3>\n<p>建立 Apollo Client 需要使用 Apollo 官方的 <code>ApolloProvider</code> React Component，它是封裝完 Context Provider 後的 React Component [註五]，所以只需要在 Component 外層，用 <code>&#x3C;ApolloProvider></code> 包起來如下</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"jsx\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk17\">&lt;</span><span class=\"mtk10\">ApolloProvider</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk17\">&lt;</span><span class=\"mtk10\">ChildComponent</span><span class=\"mtk1\"> </span><span class=\"mtk17\">/&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk17\">&lt;/</span><span class=\"mtk10\">ApolloProvider</span><span class=\"mtk17\">&gt;</span></span></span></code></pre>\n<p>裡面的 <code>&#x3C;ChildComponent /></code> 就可以取用 React Apollo 查詢回來的資料</p>\n<p><code>&#x3C;ApolloProvider></code> 需帶入 props 名稱為 client、值為 <code>new ApolloClient()</code> 創造出的物件實例，GraphQL 的 Endpoint 可在創出時，代入物件寫在裡面，如下</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"js\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk15\">import</span><span class=\"mtk1\"> </span><span class=\"mtk12\">React</span><span class=\"mtk1\"> </span><span class=\"mtk15\">from</span><span class=\"mtk1\"> </span><span class=\"mtk8\">&#39;react&#39;</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk15\">import</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ApolloClient</span><span class=\"mtk1\"> </span><span class=\"mtk15\">from</span><span class=\"mtk1\"> </span><span class=\"mtk8\">&#39;apollo-boost&#39;</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk15\">import</span><span class=\"mtk1\"> { </span><span class=\"mtk12\">ApolloProvider</span><span class=\"mtk1\"> } </span><span class=\"mtk15\">from</span><span class=\"mtk1\"> </span><span class=\"mtk8\">&#39;@apollo/react-hooks&#39;</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">const</span><span class=\"mtk1\"> </span><span class=\"mtk12\">client</span><span class=\"mtk1\"> = </span><span class=\"mtk4\">new</span><span class=\"mtk1\"> </span><span class=\"mtk10\">ApolloClient</span><span class=\"mtk1\">({ </span><span class=\"mtk12\">uri:</span><span class=\"mtk1\"> </span><span class=\"mtk8\">&#39;http://localhost:4000/graphql&#39;</span><span class=\"mtk1\"> });</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">const</span><span class=\"mtk1\"> </span><span class=\"mtk11\">App</span><span class=\"mtk1\"> = () </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> (</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk17\">&lt;</span><span class=\"mtk10\">ApolloProvider</span><span class=\"mtk1\"> </span><span class=\"mtk12\">client</span><span class=\"mtk1\">=</span><span class=\"mtk4\">{</span><span class=\"mtk12\">client</span><span class=\"mtk4\">}</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk17\">&lt;</span><span class=\"mtk10\">Child</span><span class=\"mtk1\"> </span><span class=\"mtk17\">/&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk17\">&lt;/</span><span class=\"mtk10\">ApolloProvider</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">);</span></span></span></code></pre>\n<p>建立完 Apollo Client 後，就完成了第一步</p>\n<h3 id=\"二、寫-graphql-的專用查詢語法\" style=\"position:relative;\"><a href=\"#%E4%BA%8C%E3%80%81%E5%AF%AB-graphql-%E7%9A%84%E5%B0%88%E7%94%A8%E6%9F%A5%E8%A9%A2%E8%AA%9E%E6%B3%95\" aria-label=\"二、寫 graphql 的專用查詢語法 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>二、寫 GraphQL 的專用查詢語法</h3>\n<p>看要拿甚麼資料就怎麼寫，如取得所有書籍的名稱及 ID，寫法可如下，詳細的語法使用可參考<a href=\"https://graphql.org/learn/\">這裡</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"js\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk15\">import</span><span class=\"mtk1\"> { </span><span class=\"mtk12\">gql</span><span class=\"mtk1\"> } </span><span class=\"mtk15\">from</span><span class=\"mtk1\"> </span><span class=\"mtk8\">&#39;apollo-boost&#39;</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">const</span><span class=\"mtk1\"> </span><span class=\"mtk12\">GET_BOOKS_QUERY</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">gql</span><span class=\"mtk8\">`</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">    {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">        books {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">            id</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">            name</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">`</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p>依照需要的資料寫好查詢語法後，就完成了第二步</p>\n<h3 id=\"三、依情境使用-hooks\" style=\"position:relative;\"><a href=\"#%E4%B8%89%E3%80%81%E4%BE%9D%E6%83%85%E5%A2%83%E4%BD%BF%E7%94%A8-hooks\" aria-label=\"三、依情境使用 hooks permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>三、依情境使用 Hooks</h3>\n<p><strong>情境一：進入頁面就取資料 — useQuery</strong></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8a2b87a0ee301084ce9b5564d439e33c/252a4/image6.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 69.93865030674846%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsSAAALEgHS3X78AAABrklEQVQoz4VSy47bMAz0l9SxZL0oypKsh+3Y8WaRPRXosf//K6WdHtqm7Q4oAQI45HCoxjk3DAMijmOkAMQwppyzBeg61p3ofwdj/BkNY0wKOY1Tndd52aKPJfoxBiEo6UjpOW8vB7oXNLznRsO93GtdP759v318vd0eS6l7rUvyW4kUHkFK8UpvOOdSKgeD8zFNswsRDCohAwIaovSXS8v5of9s317aM85KzTmFkBjB+TqXOEYNVmojlFGAmsI60QtDL6CXsy5Y57UBKtYI2WvgZFJd6rzklNIYvCPb/DCVMk+15IRDWG57riWWadru8/4o110p1RijjZFG6bKseboG68MQc6nEQnRKyq5tD80dI6Xn1OfFDjRaa1LlMdRpA7BaUjFLmzMGlDas+x8aSabQWmgqDBYdggItGesu7Zfub+v5k0wgP5WBaXvf3h7r2yMv+7yu1/3uQhZC/pT6Sqa5n2RDsKiMJXulot3TrgZSznn/z85EIT59ozgv5K+04GJCH11IPtVhLMOY6RZSvfY/O1Nv4h/yfk1gZOnnM2ul0dB3okOOGeeAfUZ74gc/roQ34rLb5QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image\"\n        title=\"image\"\n        src=\"/static/8a2b87a0ee301084ce9b5564d439e33c/a6d36/image6.png\"\n        srcset=\"/static/8a2b87a0ee301084ce9b5564d439e33c/222b7/image6.png 163w,\n/static/8a2b87a0ee301084ce9b5564d439e33c/ff46a/image6.png 325w,\n/static/8a2b87a0ee301084ce9b5564d439e33c/a6d36/image6.png 650w,\n/static/8a2b87a0ee301084ce9b5564d439e33c/e548f/image6.png 975w,\n/static/8a2b87a0ee301084ce9b5564d439e33c/3c492/image6.png 1300w,\n/static/8a2b87a0ee301084ce9b5564d439e33c/252a4/image6.png 1314w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>使用 <code>useQuery</code> 後，會立刻回傳一個物件。在未來某一個時間點，<code>useQuery</code> 回傳會回傳新的物件，引發 react component 再渲染一次。</p>\n<p>物件的內容，可使用 JS 解構賦值的方式，取出內部的狀態 key，對應到的值，比如可以取出 <code>loading</code> ，這個狀態是布林值。</p>\n<p>首次渲染畫面的時候，<code>useQuery</code> 的狀態分別是：<code>{ loading: true, error: undefined, data: undefined }</code> 代表的意義是，<code>useQuery</code> 已發送請求給 graphQL server，並在等待資料回來，在 loading 中。</p>\n<p>未來某一個時間點，資料回來或是收到錯誤，會回傳新的物件，進而讓 react-hook 再次渲染畫面。若正確收到資料，<code>useQuery</code> 的狀態分別是：<code>{ loading: false, error: undefined, data: dataObject{...} }</code> 代表的意義是，<code>useQuery</code> 已不在 loading 中，並可讓我們取到 data 物件。若收到錯誤，<code>useQuery</code> 的狀態分別是：<code>{ loading: false, error: errObject{...} , data: undefined }</code>，可針對錯誤進行處理。</p>\n<p>以下 <code>console.log</code> 的結果可幫助理解，共發生兩次渲染。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4526297337a29197151a972ade4be125/2cefc/image7.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 60.122699386503065%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsSAAALEgHS3X78AAAA/klEQVQoz5VR226EIBTk/39Pfalr1F2Uda0ggnLxQkfahyZtkzo54T7MMBBvrTFWyonR5tW9pNJKz8Y6lHXe+TWWd6v3X+M4PWslQnA+8FnrRQi7nBRjTAjhOAJOj+M4TZOUchzPQo+pUupzkaRpmiTJ7XZ7y/NlWcI3OOfuj0fbsr5/p213p6xpu2EYxggcJtB5RvR9H34AMtDTeh74IDBSbp5nFYFdAvUsyyBe13V0e4R/g+CmoihgA4GEiyBN01RVRSkVQqD91fyf5LIswceb4R9MXHGBjNDgfN/3cB0E0XPOt227mtZJzvOcMYbo8WdX9QlosK21RtpXlT8Alk+6ZdEAhHQAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image\"\n        title=\"image\"\n        src=\"/static/4526297337a29197151a972ade4be125/a6d36/image7.png\"\n        srcset=\"/static/4526297337a29197151a972ade4be125/222b7/image7.png 163w,\n/static/4526297337a29197151a972ade4be125/ff46a/image7.png 325w,\n/static/4526297337a29197151a972ade4be125/a6d36/image7.png 650w,\n/static/4526297337a29197151a972ade4be125/e548f/image7.png 975w,\n/static/4526297337a29197151a972ade4be125/3c492/image7.png 1300w,\n/static/4526297337a29197151a972ade4be125/2cefc/image7.png 1400w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><strong>情境二：使用者操作才取資料 — useLazyQuery</strong></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/fe276906c8715fa1982c0d9fff445a1f/d26aa/image8.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31.288343558282207%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAAsSAAALEgHS3X78AAAA+ElEQVQY03WQ626DMAyFeY5ySRMnxLkTIAFKqdR1f/b+L7SwatL+7OizdGRZ8rErkLi6nJZjvH/k11dc78nGPfoczKDRStH9rwoY071BpUPKfpq19QatEtwIZntAYE1dN01dRtu2bZqfetO2FQO4qsGM6/F67q/Pcb3H/Rm3w+VdWh+nEOaEJjBKOYe+BxACeuQSr5RWFDiX2qXdLYeZNj1MId98upWe1BatUz5K4wBAqd5aRK2lC+gjA14JDlyqOE/bEm7rYPxQFnIpCSFNfamLLpcz+Zn3fUFd+oUzNi8S/PHIhZSikChQFyhl508IOenIH0t+XfcNLXg3qQTaQZEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image\"\n        title=\"image\"\n        src=\"/static/fe276906c8715fa1982c0d9fff445a1f/a6d36/image8.png\"\n        srcset=\"/static/fe276906c8715fa1982c0d9fff445a1f/222b7/image8.png 163w,\n/static/fe276906c8715fa1982c0d9fff445a1f/ff46a/image8.png 325w,\n/static/fe276906c8715fa1982c0d9fff445a1f/a6d36/image8.png 650w,\n/static/fe276906c8715fa1982c0d9fff445a1f/d26aa/image8.png 839w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>使用 <code>useLazyQuery</code> 後，會立刻回傳一個陣列。未來若依不同情境變更了狀態，<code>useLazyQuery</code> 會回傳新的陣列，引發 react component 再渲染。</p>\n<p>陣列的內容，可使用 JS 陣列解構賦值的方式，重新命名陣列元素名稱，陣列的第一個元素為函數、第二個元素為物件。因為<a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment\">陣列解構賦值</a>的特性，不論取什麼名稱，功能不變。如可以取名為 <code>[getBookQuery, bookObj]</code>，也可取為 <code>[bananaFn, bananaObject]</code>。</p>\n<p>可再將陣列取出來的第二個元素，再解構賦值，如</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"js\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">const</span><span class=\"mtk1\"> [</span><span class=\"mtk12\">getBookQuery</span><span class=\"mtk1\">, { </span><span class=\"mtk12\">loading</span><span class=\"mtk1\">, </span><span class=\"mtk12\">error</span><span class=\"mtk1\">, </span><span class=\"mtk12\">data</span><span class=\"mtk1\"> }] = </span><span class=\"mtk11\">useLazyQuery</span><span class=\"mtk1\">(</span><span class=\"mtk12\">GET_BOOK_QUERY</span><span class=\"mtk1\">, {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">variables:</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">id:</span><span class=\"mtk1\"> </span><span class=\"mtk12\">selectedBookId</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    },</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">});</span></span></span></code></pre>\n<p>首次渲染畫面的時候，上述 loading, error, data 分別為 <code>false, undefined, undefined</code></p>\n<p>當呼叫陣列第一個元素回傳的函式 <code>getBookQuery</code> 時，開始發送請求給 graphQL server，這時上述 loading, error, data 更新為 <code>true, undefined, undefined</code></p>\n<p>當收到資料或是收到錯誤時，上述 loading, error, data 更新為 <code>false, undefined, dataObject{...}</code> 或 <code>false, errObject{...}, undefined</code></p>\n<p>以下範例 <code>console.log</code> 可幫助理解，一進入發生畫面發生了一次渲染，在使用者選完下拉選單後，再發生兩次渲染</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/de1aff688e1ddeea648b8718be2a403a/2cefc/image9.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.87116564417178%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsSAAALEgHS3X78AAABC0lEQVQoz52S7XJGMBCFc/9XyJjBUF8hskmE8PLqwVS1v5ruDJOwJ8/u2bCyLKuqkkJoRfu+b9u2n2GM6bqOiERPnHdCCEWkFV7U9wK/8LA0TcMwjOMY+/0RwzB8FEXT8rrhDccpZhxH59yyLNM0aa2xZiBAHAQBNk8xkpq2ISWRZ+3o5nWeZ+Ss63rnMBCyLFNKPb+e4rlua9IkiZQ2ZnDWDiBB//4KVhRFFEVt26JsNH/3/Fpfbnbr9uPEX8FgWJ7nfd+jPCnlLf5LMACBhYfW2t0rUPY1KhQPOPz0EwPLMceuu8zwYh9iYI97IiWch4ceYkzvmriXVd+GQXy28PbCHuIkSa578w/yJ2vb9jzsHs2VAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image\"\n        title=\"image\"\n        src=\"/static/de1aff688e1ddeea648b8718be2a403a/a6d36/image9.png\"\n        srcset=\"/static/de1aff688e1ddeea648b8718be2a403a/222b7/image9.png 163w,\n/static/de1aff688e1ddeea648b8718be2a403a/ff46a/image9.png 325w,\n/static/de1aff688e1ddeea648b8718be2a403a/a6d36/image9.png 650w,\n/static/de1aff688e1ddeea648b8718be2a403a/e548f/image9.png 975w,\n/static/de1aff688e1ddeea648b8718be2a403a/3c492/image9.png 1300w,\n/static/de1aff688e1ddeea648b8718be2a403a/2cefc/image9.png 1400w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><strong>情境三：使用者輸入後，傳資料給 server — useMutation</strong></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1d0cc118664ab971f6e4fde28dee8294/01267/image10.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 44.171779141104295%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsSAAALEgHS3X78AAABQElEQVQoz3WQjU6DMBSFeQ9Kf1cKLaXAVgplg01BzTSa+P4PY8dMNLp9uUl7k3Nu7rkR2aRMNZlS3jdVbQilECGECUQYEYoxCQ1MAEGQEEQZI2zDeEoZJ5RFdMPTqtNNOzy/2mnR1lfWbZ1zg28Poz0u9vRsrPPTuB+9MrWsrbZ9YXtZVhGllBvXH4blvCzn2fpeVbuyLLTO8jzNVCEKI4oylZpneXIFxNc3ghCZupof+4eTncZtXWkAwEUArhWHSuL4YgAAXkAh1/qBEcZYpNxNx/Y4167jImNchNTwt/Rb/JcoXCiMLN3BzW/d08dw/vQv73rnCKEI3TH9mAMYZ7LITcMzqeqdNFtpmtAijJM1AoTJbXMYL4QwtlNNW+w6kUupTXAKbUy3L91Qtj4I1hH/zOHaUsqQHK1AdAN4Z/8v/kBSa/VYGX8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image\"\n        title=\"image\"\n        src=\"/static/1d0cc118664ab971f6e4fde28dee8294/a6d36/image10.png\"\n        srcset=\"/static/1d0cc118664ab971f6e4fde28dee8294/222b7/image10.png 163w,\n/static/1d0cc118664ab971f6e4fde28dee8294/ff46a/image10.png 325w,\n/static/1d0cc118664ab971f6e4fde28dee8294/a6d36/image10.png 650w,\n/static/1d0cc118664ab971f6e4fde28dee8294/01267/image10.png 713w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>使用 <code>useMutation</code> 後，會立刻回傳一個陣列。未來若依不同情境變更了狀態， <code>useMutation</code> 會回傳新的陣列，引發 react component 再渲染。</p>\n<p>陣列的內容，可使用 JS 陣列解構賦值的方式取出，像 <code>useLazyQuery</code> 一樣。</p>\n<p>這個陣列的第一個元素是函式。觸發這個函式，就會開始發送請求給 graphQL server。</p>\n<p>這個陣列的第二個元素是物件。可知道各個時間點的 loading, error, data 狀態</p>\n<p>經過上述的 Hooks 使用，可以滿足大部分的操作情境。</p>\n<hr>\n<h1 id=\"四-結語\" style=\"position:relative;\"><a href=\"#%E5%9B%9B-%E7%B5%90%E8%AA%9E\" aria-label=\"四 結語 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>(四) 結語</h1>\n<p>時至 2020 年 6 月的今天，如果採用 GraphQL 及 React Apollo，可能有以下的優點</p>\n<ol>\n<li>GraphQL 可做為 API Gateway ，讓前端更方便、更精準的操作資料</li>\n<li>React Apollo 可滿足大部分資料操作情境，比如向 server 取資料、再取更多資料、修改資料等等</li>\n<li>React Apollo 也幫我們在 React 的架構下，使用 Hook 及 Context API 完成了資料的存放、錯誤狀態的處理等等，實際上用起來，程式碼簡單不少。</li>\n</ol>\n<p>希望可以加速各位開發速度，有機會的話試用看看吧</p>\n<hr>\n<h1 id=\"註解：\" style=\"position:relative;\"><a href=\"#%E8%A8%BB%E8%A7%A3%EF%BC%9A\" aria-label=\"註解： permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>註解：</h1>\n<ul>\n<li>註一：即 server 的資料，經過網路傳輸後，由瀏覽器頁面顯示。文章所提的前後端的串接，指後端（Server） 傳給前端（Client）一個 JSON 格式的資料，這個資料再被前端解析後取用，又稱 Client Side Render</li>\n<li>註二：詳細的原因及 Redux 官方對 Middleware 的說明<a href=\"https://redux.js.org/advanced/middleware\">在此</a></li>\n<li>註三： <em>RxJS is sometimes described as \"LoDash for asynchronous events.\"</em> --- from <a href=\"https://books.google.com.tw/books?id=4E0qDwAAQBAJ&#x26;pg=SA8-PA28&#x26;lpg=SA8-PA28&#x26;dq=rxjs+async+lodash&#x26;source=bl&#x26;ots=fLd17EwjLO&#x26;sig=ACfU3U0NyqfxEqL_JZ1VFOXKLqVnfbaRSQ&#x26;hl=zh-TW&#x26;sa=X&#x26;ved=2ahUKEwjej9f6nazpAhURCqYKHVVQDSIQ6AEwAnoECAkQAQ#v=onepage&#x26;q=rxjs%20async%20lodash&#x26;f=false\">Angular2 Pocket Primer</a></li>\n<li>註四：來源資料陣列範例如下\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 589px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/bcaf2f7bb97360f3de29e79f65dd2c6a/b1665/image11.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 47.239263803680984%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsSAAALEgHS3X78AAABXklEQVQoz22PWW7cMBBEdY5I4ipxJ5uLlrHk8XhgGMj9T5TW5CeAU2iABYJV/dgZY4Sc0n6Hx/dby9VbsHpNzhsNt7txYY14o3TMRivjXDk+fV70JOd57pRSnNJUF9jfq1VbcrdoD3ABSvn4jt6jz9G7BFfddq7P39DWYM00TZ3WmjNatqN+fFWnjgpLazuEtZblfISUd/AFIG1nggx1qeenCdGoWUrZXdicwbrD8bh2VsAXeTtLzkjRSvYhRswte31/xtKctZOUIxkpJRc2dgghCL2EFGQYKOcjoYSMjOBJR4J2YJxTLsgr9ledQexJzbHOuRoANU+Sc8GuIiYE4wwziEYZ9mDJSP5Rp7TGZXm9lfO5BX2UcJR4rxFiaPevtrW03jyyWkN+6PVnwWNuYXlLei7eLNEuwTgfMBZzsgk04kj5nzBHKikZo33/axhHnH645vJ9P/QDanzpZ/gPTKRU3FoOchQAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image\"\n        title=\"image\"\n        src=\"/static/bcaf2f7bb97360f3de29e79f65dd2c6a/b1665/image11.png\"\n        srcset=\"/static/bcaf2f7bb97360f3de29e79f65dd2c6a/222b7/image11.png 163w,\n/static/bcaf2f7bb97360f3de29e79f65dd2c6a/ff46a/image11.png 325w,\n/static/bcaf2f7bb97360f3de29e79f65dd2c6a/b1665/image11.png 589w\"\n        sizes=\"(max-width: 589px) 100vw, 589px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></li>\n<li>註五：實際封裝的狀況，可以在瀏覽器下載 React 開發人員套件，使用開發人員工具看出，被封裝了三層。在最內層的 Context.Provider 內的某個 props 節點下，有取回來的 data\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/533e6318050c977d9c0e0bb82cbb7387/2cefc/image12.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 43.558282208588956%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsSAAALEgHS3X78AAABhElEQVQoz3WQzU7CQBhF+xIyBdpSoQNtgUqLEKJufCZjDAkujIlP5saNxpVE2kJE/lKmMBRaCrQ4/GhI1JOZb3fmfncoezTq9vrOdDr3fXuMLYQsZCN7ZA0ROe3Ptm7oDXJ102iaeqP5Vtcb76ZptAyzSdXr9U6nE4bhOgwdC+Fe3x1avuti7ATL9cP9nZyXVU1TchvkbF6Wc0r+RFOLmlakDMNACK0JC3/48mo8vvSfnsftD3s8ns/9q+sbEIkoOVVWS1JK4FkmHiNEAQ1omqZarZbjOL7vh0HgzWaDzhDb2HPdycQh29RqNfooUixUsmeXalY5z0uFDOQ5jtlCdbtdkjwYDJar1fqAIAjIJDIAIAEzyVRKENPpjMCxbDzO7GXP836ETfNvVtu3bolM08WMdAGF0wRX5jieYb5dhsIYLxaLnfZb3iVnISxXSiVJVnj++FDeFf4vuVqt0gAwyWREEqMsC6KxaHzDXj7s+adM1oZyDoowIQhQFCVRSKeSie2ffQHzQkaTyFtP+AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image\"\n        title=\"image\"\n        src=\"/static/533e6318050c977d9c0e0bb82cbb7387/a6d36/image12.png\"\n        srcset=\"/static/533e6318050c977d9c0e0bb82cbb7387/222b7/image12.png 163w,\n/static/533e6318050c977d9c0e0bb82cbb7387/ff46a/image12.png 325w,\n/static/533e6318050c977d9c0e0bb82cbb7387/a6d36/image12.png 650w,\n/static/533e6318050c977d9c0e0bb82cbb7387/e548f/image12.png 975w,\n/static/533e6318050c977d9c0e0bb82cbb7387/3c492/image12.png 1300w,\n/static/533e6318050c977d9c0e0bb82cbb7387/2cefc/image12.png 1400w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></li>\n</ul>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .dark-default-dark {\n    background-color: #1E1E1E;\n    color: #D4D4D4;\n  }\n  .dark-default-dark .mtk17 { color: #808080; }\n  .dark-default-dark .mtk10 { color: #4EC9B0; }\n  .dark-default-dark .mtk1 { color: #D4D4D4; }\n  .dark-default-dark .mtk15 { color: #C586C0; }\n  .dark-default-dark .mtk12 { color: #9CDCFE; }\n  .dark-default-dark .mtk8 { color: #CE9178; }\n  .dark-default-dark .mtk4 { color: #569CD6; }\n  .dark-default-dark .mtk11 { color: #DCDCAA; }\n  .dark-default-dark .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>","tableOfContents":"<ul>\n<li>\n<p><a href=\"#%E4%B8%80-%E5%BC%95%E8%A8%80\">(一) 引言</a></p>\n<ul>\n<li><a href=\"#%E6%97%A9%E6%9C%9F%EF%BC%9A-xmlhttprequest\">早期： XMLHttpRequest()</a></li>\n<li><a href=\"#%E4%B8%AD%E6%9C%9F%EF%BC%9A-fetch-api\">中期： Fetch API</a></li>\n<li><a href=\"#%E8%BF%91%E6%9C%9F%EF%BC%9A-2013-%E5%B9%B4-facebook-%E9%A6%96%E6%AC%A1%E6%8E%A8%E5%87%BA-react-%E5%BE%8C\">近期： 2013 年 Facebook 首次推出 React 後</a></li>\n<li><a href=\"#%E6%9C%80%E8%BF%91%EF%BC%9A2015-%E5%B9%B4-redux-%E6%8E%A8%E5%87%BA-react-redux\">最近：2015 年 Redux 推出 react-redux</a></li>\n<li><a href=\"#but-\">But ...</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%E4%BA%8C-%E4%BB%8B%E7%B4%B9\">(二) 介紹</a></p>\n<ul>\n<li><a href=\"#%E4%BB%80%E9%BA%BC%E6%98%AF-graphql%EF%BC%9F\">什麼是 GraphQL？</a></li>\n<li><a href=\"#%E6%96%B0%E7%9A%84%E6%9F%A5%E8%A9%A2%E8%AA%9E%E8%A8%80--%E4%BD%BF%E7%94%A8%E5%AE%A3%E5%91%8A%E5%BC%8F%E8%AA%9E%E6%B3%95\">新的查詢語言 — 使用宣告式語法</a></li>\n<li><a href=\"#%E8%88%87%E6%97%A2%E5%AD%98%E8%B3%87%E6%96%99%E4%BA%92%E5%8B%95%E7%9A%84%E5%9F%B7%E8%A1%8C%E7%92%B0%E5%A2%83\">與既存資料互動的執行環境</a></li>\n<li><a href=\"#%E4%BB%80%E9%BA%BC%E6%98%AF-react-apollo%EF%BC%9F\">什麼是 React Apollo？</a></li>\n<li>\n<p><a href=\"#%E7%82%BA%E4%BB%80%E9%BA%BC%E8%A6%81%E7%94%A8-graphql--react-apollo%EF%BC%9F\">為什麼要用 GraphQL / React Apollo？</a></p>\n<ul>\n<li><a href=\"#%E4%B8%80%E3%80%81%E4%B8%B2%E6%8E%A5%E5%BE%8C%E7%AB%AF%E5%BE%9E%E5%A4%9A%E5%80%8B-endpoint-%E8%AE%8A%E4%B8%80%E5%80%8B\">一、串接後端從多個 Endpoint 變一個</a></li>\n<li><a href=\"#%E4%BA%8C%E3%80%81%E5%89%8D%E7%AB%AF%E7%B2%BE%E6%BA%96%E5%8F%96%E5%BE%97%E8%87%AA%E5%B7%B1%E8%A6%81%E7%9A%84%E8%B3%87%E6%96%99\">二、前端精準取得自己要的資料</a></li>\n<li><a href=\"#%E4%B8%89%E3%80%81%E8%99%95%E7%90%86%E9%9D%9E%E5%90%8C%E6%AD%A5%E7%9A%84%E8%A4%87%E9%9B%9C%E9%82%8F%E8%BC%AF%EF%BC%8C%E4%B8%8D%E9%9C%80%E8%A6%81%E8%87%AA%E5%B7%B1%E8%99%95%E7%90%86\">三、處理非同步的複雜邏輯，不需要自己處理</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%E4%B8%89-%E5%AF%A6%E4%BD%9C\">(三) 實作</a></p>\n<ul>\n<li><a href=\"#%E5%89%8D%E7%BD%AE%E6%BA%96%E5%82%99--graphql-server\">前置準備 — GraphQL Server</a></li>\n<li>\n<p><a href=\"#%E4%BD%BF%E7%94%A8-react-apollo-%E4%B8%89%E6%AD%A5%E9%A9%9F\">使用 React Apollo 三步驟</a></p>\n<ul>\n<li><a href=\"#%E4%B8%80%E3%80%81%E5%BB%BA%E7%AB%8B-apollo-client\">一、建立 Apollo Client</a></li>\n<li><a href=\"#%E4%BA%8C%E3%80%81%E5%AF%AB-graphql-%E7%9A%84%E5%B0%88%E7%94%A8%E6%9F%A5%E8%A9%A2%E8%AA%9E%E6%B3%95\">二、寫 GraphQL 的專用查詢語法</a></li>\n<li><a href=\"#%E4%B8%89%E3%80%81%E4%BE%9D%E6%83%85%E5%A2%83%E4%BD%BF%E7%94%A8-hooks\">三、依情境使用 Hooks</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><a href=\"#%E5%9B%9B-%E7%B5%90%E8%AA%9E\">(四) 結語</a></li>\n<li><a href=\"#%E8%A8%BB%E8%A7%A3%EF%BC%9A\">註解：</a></li>\n</ul>","frontmatter":{"date":"2020/06/24","title":"GraphQL 與 React Apollo","category":"Frontend","tags":["GraphQL","React"],"author":"Andy Chou","authorPhoto":{"childImageSharp":{"fluid":{"src":"/static/f91e13aa4338a2347c3e1440bb2a4a07/0f3a1/andy.jpg","originalName":"andy.jpg"}}},"bannerPhoto":{"childImageSharp":{"fluid":{"src":"/static/743f26eb936122c6428bd553a90ad704/ee604/image0.png","originalName":"image0.png"}}},"youtubePath":"http://www.youtube.com/watch?v=0Bb2btvd6Ns"},"fields":{"slug":"blog/Frontend/graphql-and-react-apollo"}}},"pageContext":{"slug":"blog/Frontend/graphql-and-react-apollo"}},"staticQueryHashes":["1351831723","2394719841"]}