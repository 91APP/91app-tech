{"componentChunkName":"component---src-templates-blog-template-tsx","path":"/blog/Architecture/91app-queue-system","result":{"data":{"markdownRemark":{"html":"<p>今天想跟大家分享 91APP Queue System 是如何做的，這次分享的內容會從幾個面向切入討論與分析</p>\n<ol>\n<li>什麼是 Queue？</li>\n<li>Queue 適合的使用場景</li>\n<li>挑戰</li>\n<li>91APP 怎麼做？</li>\n<li>總結</li>\n</ol>\n<!--more-->\n<hr>\n<h1 id=\"什麼是-queue？\" style=\"position:relative;\"><a href=\"#%E4%BB%80%E9%BA%BC%E6%98%AF-queue%EF%BC%9F\" aria-label=\"什麼是 queue？ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>什麼是 Queue？</h1>\n<p>Queue 又稱為隊列，我們可以將它想像成水管，你可以從一側一直將資料放進去，從另一側將資料取出來，是一個先進先出的資料結構。詳細的定義也可以參考 <a href=\"https://zh.wikipedia.org/wiki/%E9%98%9F%E5%88%97\">Wiki</a> 的介紹</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2818e3548dee8b55068f15123b1edec2/a0730/1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 37.423312883435585%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABCElEQVQY021QbU+DMBDm//+xgfJBFoySQSvEIYMBUo7C6LX1uklCok/ay7XJ83LnWWtRCBmGLecszz84HwHcp9baGDRG7w7B7uDR1UJA8KSaGjWuCmXXD2/vU3OlCtVFpBl8nse8oMYpOk2zIw8C/EA1lTULWeK1hiDAuqG6nkt5PN4yNifJTI1S6SllLOv77408jlMYqq6/y63qUgA965rqWpYyjhfO51NKKhYlpVvafopfzTx7v/GVslsYbHsKgkT2feccRTfGliSRLxEZUTqsKzgcyNKzf7AMYsjY1HWCcZp8LAqoqrEsaWya1xl9cZpIA/xDfuxUI7p6X4/e8FiVajt4DjVMP+8kjLxu/AP4AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"1\"\n        title=\"1\"\n        src=\"/static/2818e3548dee8b55068f15123b1edec2/a6d36/1.png\"\n        srcset=\"/static/2818e3548dee8b55068f15123b1edec2/222b7/1.png 163w,\n/static/2818e3548dee8b55068f15123b1edec2/ff46a/1.png 325w,\n/static/2818e3548dee8b55068f15123b1edec2/a6d36/1.png 650w,\n/static/2818e3548dee8b55068f15123b1edec2/e548f/1.png 975w,\n/static/2818e3548dee8b55068f15123b1edec2/a0730/1.png 1131w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<hr>\n<h1 id=\"queue-適合的使用場景\" style=\"position:relative;\"><a href=\"#queue-%E9%81%A9%E5%90%88%E7%9A%84%E4%BD%BF%E7%94%A8%E5%A0%B4%E6%99%AF\" aria-label=\"queue 適合的使用場景 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Queue 適合的使用場景</h1>\n<h2 id=\"1非同步處理\" style=\"position:relative;\"><a href=\"#1%E9%9D%9E%E5%90%8C%E6%AD%A5%E8%99%95%E7%90%86\" aria-label=\"1非同步處理 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1.非同步處理</h2>\n<p>如下圖，是以成立訂單為例，前台在訂單成立時，需要發送通知信告知消費者訂單成立的相關訊息，而我們通常有幾種策略可以採用。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/507a88757940d607d1dad285b4afd1d4/46435/2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 38.65030674846626%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABE0lEQVQY06WRW0vDQBCF8/+fVARfpCkFf0JFVJA2kepLBTGWWGp6iakxaZPddC/Zzc6aG95AX/yYh112zpzhrKH/gaE11NUiCrhwNieD6bmTMKH017cPAKqqxc0VMMaMkh1Xx0N/r+92rCBlRdP5q/PyzQu2K14wShnjnAroWsuD04k5WCBWgMhLRAnnnBApC53j9OUp8V3YRcatY9/Px1meNcOoUF1rtd9/7AwXSbwRs6mCylvGMRnfiTDUNFw7lv8whK3Xrq2UiqI4TVKSq57tH565vdEryriMwspYSo4Q8eYCoW9rQ015klJqUKXYvF4fXfmmHaRU1nPbDvjMq5UYPzKQCm6e8eUkGc1wmfzfX/UOla7HSUm1ysAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2\"\n        title=\"2\"\n        src=\"/static/507a88757940d607d1dad285b4afd1d4/a6d36/2.png\"\n        srcset=\"/static/507a88757940d607d1dad285b4afd1d4/222b7/2.png 163w,\n/static/507a88757940d607d1dad285b4afd1d4/ff46a/2.png 325w,\n/static/507a88757940d607d1dad285b4afd1d4/a6d36/2.png 650w,\n/static/507a88757940d607d1dad285b4afd1d4/e548f/2.png 975w,\n/static/507a88757940d607d1dad285b4afd1d4/3c492/2.png 1300w,\n/static/507a88757940d607d1dad285b4afd1d4/46435/2.png 1885w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><strong>策略一：直接將寄信的程序埋在前台</strong></p>\n<p>這種方式最為直接也幾乎不會有延遲，但缺點卻很明顯，如寄信服務異常或延遲時可能會間接拖垮前台服務</p>\n<p><strong>策略二：排程定時撈取還未寄發信件的訂單</strong></p>\n<p>此種方法可以讓寄信邏輯與服務與前台脫鉤，但無可避免的會有系統性的延遲，例如：排程設定 5 分鐘，那一封信最多可能會延遲至 5 分鐘才寄達消費者手中</p>\n<p><strong>策略三：透過 Queue 來處理</strong></p>\n<p>前台在成立訂單時將要發送信件的任務資訊塞進 Queue 中，寄信服務從 Queue 中取得要寄送信件的任務與相關資訊來執行寄信，這個不僅讓寄信服務與前台解耦，如果寄信服務處理速度夠快，也可以做到幾乎即時的效果。</p>\n<h2 id=\"2應付瞬間巨量\" style=\"position:relative;\"><a href=\"#2%E6%87%89%E4%BB%98%E7%9E%AC%E9%96%93%E5%B7%A8%E9%87%8F\" aria-label=\"2應付瞬間巨量 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2.應付瞬間巨量</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b00c533fcde69871fbddb673e5970134/46435/3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 35.58282208588957%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABH0lEQVQY031Q206DQBDl/x981MRL1E/QhzZpNE3alMZgI6GUoiBgKbdyKywLuwssUlCj0XgyyWTOzMmZGaYoc3/vRSAo67LpkOGaVeI7wZHdvPkXTAA9Tp6Lb0+AgKpuGWpG+GRsHg2UWz7shyilGGP6W5zh1EscH3ioRLTrWzG+Zr2LmTdchq2OYIyKIgrCNhFMmroqgQ8CiwCfiXJ/8fwgbYSMwN55G6PLmXs2cQarqPJdKCxzSUJruWhDURsMUuNR5UbAWDAAJ+7e2qU2Kou6c27FV6x7PrWHq7hKU6i+ZpqeaRrU9dzc0Lr63JoyYb7jpLlo8JBknZhuI3Q6cY7H9g0fHOqf8cHQw4nM9wf0PYCq6Utyv45FC36Rf+Id1LKI24UiUcUAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"3\"\n        title=\"3\"\n        src=\"/static/b00c533fcde69871fbddb673e5970134/a6d36/3.png\"\n        srcset=\"/static/b00c533fcde69871fbddb673e5970134/222b7/3.png 163w,\n/static/b00c533fcde69871fbddb673e5970134/ff46a/3.png 325w,\n/static/b00c533fcde69871fbddb673e5970134/a6d36/3.png 650w,\n/static/b00c533fcde69871fbddb673e5970134/e548f/3.png 975w,\n/static/b00c533fcde69871fbddb673e5970134/3c492/3.png 1300w,\n/static/b00c533fcde69871fbddb673e5970134/46435/3.png 1885w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>第二種常常使用 Queue 的情境是為了解決瞬間巨量，例如我們公司常常會在雙 11 時搶購期間瞬間湧入大量使用進行搶購，這時候 Queue 就成為一個很好的緩衝工具，前台在成立訂單時一樣將寄信的任務資訊塞進 Queue，寄信服務可以依據自己能處理的速度穩定的消化，無須為了搶購同時擴展前台與寄信服務。</p>\n<p>當然如果認為寄信服務處理速度應該跟上訂單成立的速度，我們也可以同時擴展寄信服務，有個 Queue 做為緩衝，可調配的空間也會大上許多</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ef07e2e14742d4d89204106a07e2539f/497e1/4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 36.809815950920246%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABH0lEQVQY023OW0+DMBQHcL7/uy+6uPgBfDLO+OAecC4xjoTLcA6tIoxxEUYLpWvLpcLGlrh4ctK0Jz35/SXxX9WNaLpujpOT+/4pIZou3VcQWAUv6m7SJEV1PfOHY2sKsuP33XlqSBlNrdXiK3wn/bLwILuQ12cPzo2W9EHqGmV5j9cUOTpQZeyZnbxw5sBfkrKXvZQOn4LBJBgZG8E5g5DCFMcxRYhlSJQF+wHINXkMpJxBO/xwE5twspfXkLXLLT4y0yr0sKJgVcOahnW9MA3BYO6o3+q4cFUJ0kQDyttqTkp8kNnlJDiX/VsjbeiWhtE26pvGseCYZyGO3TKPWhk50ae3cQ5y40N2NQ0Gj/5dG/tP7YJVBIJn8HKP7dkvq2CGGp7617gAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"4\"\n        title=\"4\"\n        src=\"/static/ef07e2e14742d4d89204106a07e2539f/a6d36/4.png\"\n        srcset=\"/static/ef07e2e14742d4d89204106a07e2539f/222b7/4.png 163w,\n/static/ef07e2e14742d4d89204106a07e2539f/ff46a/4.png 325w,\n/static/ef07e2e14742d4d89204106a07e2539f/a6d36/4.png 650w,\n/static/ef07e2e14742d4d89204106a07e2539f/e548f/4.png 975w,\n/static/ef07e2e14742d4d89204106a07e2539f/3c492/4.png 1300w,\n/static/ef07e2e14742d4d89204106a07e2539f/497e1/4.png 1891w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2 id=\"3系統間解耦\" style=\"position:relative;\"><a href=\"#3%E7%B3%BB%E7%B5%B1%E9%96%93%E8%A7%A3%E8%80%A6\" aria-label=\"3系統間解耦 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3.系統間解耦</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3ecb4ec254a4b02cf44bbdec52f9c177/a303f/5.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 42.331288343558285%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA8UlEQVQY06WQy07DMBBF8/8bxJ8A4rFEbJAQjxaoQJSKikYkcZIm8Sv2jJ0xbRO1Cygbro43o+u5MxOFfyhaPdqy0T6rV2X9NeXpjKzYff6pVYtu02ZL6JwrpvH4MplckWK9K2qxW5Tyk4ml9rypiyJHKYBzK4RJU5PnbcZQNIGAsAVZoaqDhyH5PbeHp5OD48ejUQFWO2cxWUAcA2Pq/kE/PavRGOOPEADZ69v1yfz2nGQyJDtPGqld0w0zA4CUVilTLm1VmbJErQN58hhoDXXur51/O4ND9jK7OZvfXZBMh+T9btrRFwyHJgOeBdR95RvrFM8pVBojQwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"5\"\n        title=\"5\"\n        src=\"/static/3ecb4ec254a4b02cf44bbdec52f9c177/a6d36/5.png\"\n        srcset=\"/static/3ecb4ec254a4b02cf44bbdec52f9c177/222b7/5.png 163w,\n/static/3ecb4ec254a4b02cf44bbdec52f9c177/ff46a/5.png 325w,\n/static/3ecb4ec254a4b02cf44bbdec52f9c177/a6d36/5.png 650w,\n/static/3ecb4ec254a4b02cf44bbdec52f9c177/e548f/5.png 975w,\n/static/3ecb4ec254a4b02cf44bbdec52f9c177/3c492/5.png 1300w,\n/static/3ecb4ec254a4b02cf44bbdec52f9c177/a303f/5.png 1733w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Queue 的第三種常用情境是拿來做為 <strong>系統間解耦</strong> 的工具，以圖中的案例來說，會員中心會在會員升等時將相關資訊塞到 Queue 中，對會員升等有興趣的各個服務只要訂閱這條 Queue，就能在會員升等時即時收到相關訊息，並做後續各服務職責內的處理。而會員中心並不知道到底誰關心會員升等的訊息，它只是忠實的將資訊送出即可。</p>\n<p>如果公司因為業務的發展多個一組優惠券服務，希望能在升等時同時發送優惠券給會員，只要將優惠券服務開發完成後上線，並訂閱會員升等的 Queue，相關功能就完成，系統之間彼此透過 Queue 來達成解耦，不用因為需求的增減頻繁的異動會員中心。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/86cc5b56998882387817fb9b17f6ac31/d3d45/6.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 39.263803680981596%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABAUlEQVQY05VRTUvEQAzt/7958OIvEC96VFSKIh4Erbgy7BZ3a1m3rW2ntmNnmulME1s/yq6woI8QkhdeEhKH/gckxDFxBgKp+yTX+C0AnjPXOz9IHk4J3pyNtohaa2NMH3dfQPyxvmzJSCOSpliZKiYLTtXYaz+7YtHNouQC0iQqRdXGEfBCpen7zJdBUM8X8jkg2/SChi/zpS/zcBC/lGb3eLZzdLvnhmEuifqxqJ+mbZbrOKo9TzGmHpliE7I1NZxPLyaXhxlzf689ogMNSoGUUFUgRO91XVOnh80Jvy9H6IzRn46tXjlz78724/uTrZM3v7P2CQtWxKpYtWVEBj4ApILMADNzDrUAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"6\"\n        title=\"6\"\n        src=\"/static/86cc5b56998882387817fb9b17f6ac31/a6d36/6.png\"\n        srcset=\"/static/86cc5b56998882387817fb9b17f6ac31/222b7/6.png 163w,\n/static/86cc5b56998882387817fb9b17f6ac31/ff46a/6.png 325w,\n/static/86cc5b56998882387817fb9b17f6ac31/a6d36/6.png 650w,\n/static/86cc5b56998882387817fb9b17f6ac31/e548f/6.png 975w,\n/static/86cc5b56998882387817fb9b17f6ac31/3c492/6.png 1300w,\n/static/86cc5b56998882387817fb9b17f6ac31/d3d45/6.png 1614w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2 id=\"比較-queue-與-load-balancer-的差異\" style=\"position:relative;\"><a href=\"#%E6%AF%94%E8%BC%83-queue-%E8%88%87-load-balancer-%E7%9A%84%E5%B7%AE%E7%95%B0\" aria-label=\"比較 queue 與 load balancer 的差異 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>比較 Queue 與 Load Balancer 的差異</h2>\n<p>如下圖，應該可以感覺到 Load Balancer 跟 Queue 有點類似，都有點在做附載平衡的感覺，那我們什麼時候該選用 Load Balance 什麼時候該選用 Queue 呢？</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/adda4908defb625f2c63d4460dbf1869/8c833/7.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.828220858895705%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABj0lEQVQoz3VSS0/bQBDOH6449Ie0F06V6KGUGwd+QTkgVWolQFGagCryWIfEju2NnexrvLszHccmqEKsPo88s/PN47MH9O7B9kHsXggjYSBTwvJOzX/RdsGxQZfoI0JoEbvMlkN5nltr+0LBEUX0xldJIxdo5Cv5x2P95Xpx/jNNK00IREFVxcmHj58/nZLfk5MtmZub3K2GWtzi/vmVXCqfSPtcOWhCOx6RSKdfL86+X56Xdcq10GuKHkF5KZpi/l/nt2fvdrXd1q4yjXmRAMkWsBoqcUt95xgJGgQ4gt0WPALDs/WHIMP3kRC7nAGLw0K0tgPXYhzdo/LxcKVSWI91MiSVU3wZO/DVwfa5IThrndZWKac0GHOo5cntvJxB8YR22+/cBLy6L77diKu7HIA/SQAxa7KNXyQwHNnRHzsZky0pAqo1rEcmuSdT9OSIKKSbbrQoXeR9mL3b7WWeiWn296Fazm2WcUGKjqxsypnLn8jV76ndTr+15WQ5flhNClcet2GR+Q/Ts9+kN+z/A81IdwBoCWlmAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"7\"\n        title=\"7\"\n        src=\"/static/adda4908defb625f2c63d4460dbf1869/a6d36/7.png\"\n        srcset=\"/static/adda4908defb625f2c63d4460dbf1869/222b7/7.png 163w,\n/static/adda4908defb625f2c63d4460dbf1869/ff46a/7.png 325w,\n/static/adda4908defb625f2c63d4460dbf1869/a6d36/7.png 650w,\n/static/adda4908defb625f2c63d4460dbf1869/e548f/7.png 975w,\n/static/adda4908defb625f2c63d4460dbf1869/3c492/7.png 1300w,\n/static/adda4908defb625f2c63d4460dbf1869/8c833/7.png 1609w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>以我們的經驗來說，如果是需要較為即時性的服務，例如：<strong>商用 API</strong>，則選用 Load Balancer 較為合適，因為 Queue 具有緩衝的功能，換言之當瞬間巨量進來時，來不及處理的會暫時放在 Queue 中，這對於要求低延遲來說並不是個很好的解決方式。</p>\n<p>所以通常這類狀況都會選用 Load Balancer，並且對於服務的資源監控較為嚴格，為了避免被瞬間巨量衝垮，可能在服務 CPU 或是 Memory 到達 60 ~ 70% 左右時就開始擴展節點，以應付不知何時會來的巨量請求。</p>\n<p>相反的如果我們對於這服務的延遲容忍度較高，那 Queue 就是一個很好的選擇，對於面對 Queue 的服務來說，它永遠是用自己能處理的 <strong>最快</strong> 速度在消化 Queue 中的訊息，前面的瞬間巨量不會直接衝進服務之中進而壓垮服務，我們也可以透過滯後指標像是 Queue Length 來判斷 Queue 是否已經開始堆積，需要擴充服務節點來加快消化速度。</p>\n<h2 id=\"挑戰\" style=\"position:relative;\"><a href=\"#%E6%8C%91%E6%88%B0\" aria-label=\"挑戰 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>挑戰</h2>\n<ol>\n<li>如何簡化團隊串接 Queue 的門檻</li>\n<li>100+ Queue 與 worker 如何開發、維運、監控與部署</li>\n</ol>\n<hr>\n<h1 id=\"91app-怎麼做？\" style=\"position:relative;\"><a href=\"#91app-%E6%80%8E%E9%BA%BC%E5%81%9A%EF%BC%9F\" aria-label=\"91app 怎麼做？ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>91APP 怎麼做？</h1>\n<h2 id=\"messageworker-sdk-製作\" style=\"position:relative;\"><a href=\"#messageworker-sdk-%E8%A3%BD%E4%BD%9C\" aria-label=\"messageworker sdk 製作 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>MessageWorker SDK 製作</h2>\n<p>我們對於一些比較常用 Queue，例如：RabbitMQ、NATS、NATS Streaming 的 SDK 再做一層封裝，讓團隊在串接 Queue 時使用的 API 一致，轉換 Queue 時只要更改設定即可完成</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2a9393b2ddbf6dbee2d21ed357fda3c6/5f7fb/8.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31.901840490797547%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA3UlEQVQY0zWQ7W6DMAxFef+HXKW10iABf8R24kDX1YHu/sHK0dWxmVpzq01VTcV7fz6fMd9uX0tKf+7du9oZKd193/fjOIgp5xzDhEiP+zekH94WU/YaXV1zxlJeAE3k/nisaTZYlLHV6u7MDIFam5honmdGYFgLbaalWvUgvb8Qq2jKGZAQcds2PlNKEZHYZiKWlE5MxGWAwYkChrmqLWu01ngx/VxwZZjValBCsIJx1Sen+Rdgr5VCxdyEWrX4Ce2fX2UbyiIqQxsLxRjfOC7MbgYDX2ysZQOWq/wGj69VONRh78EAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"8\"\n        title=\"8\"\n        src=\"/static/2a9393b2ddbf6dbee2d21ed357fda3c6/a6d36/8.png\"\n        srcset=\"/static/2a9393b2ddbf6dbee2d21ed357fda3c6/222b7/8.png 163w,\n/static/2a9393b2ddbf6dbee2d21ed357fda3c6/ff46a/8.png 325w,\n/static/2a9393b2ddbf6dbee2d21ed357fda3c6/a6d36/8.png 650w,\n/static/2a9393b2ddbf6dbee2d21ed357fda3c6/e548f/8.png 975w,\n/static/2a9393b2ddbf6dbee2d21ed357fda3c6/3c492/8.png 1300w,\n/static/2a9393b2ddbf6dbee2d21ed357fda3c6/5f7fb/8.png 1889w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>我們也在 SDK 中埋入了以下功能讓維運門檻降低</p>\n<ul>\n<li>Graceful shutdown</li>\n<li>效率指標</li>\n<li>串接 CloudWatch</li>\n</ul>\n<h2 id=\"讓團隊專注於商業邏輯開發\" style=\"position:relative;\"><a href=\"#%E8%AE%93%E5%9C%98%E9%9A%8A%E5%B0%88%E6%B3%A8%E6%96%BC%E5%95%86%E6%A5%AD%E9%82%8F%E8%BC%AF%E9%96%8B%E7%99%BC\" aria-label=\"讓團隊專注於商業邏輯開發 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>讓團隊專注於商業邏輯開發</h2>\n<p>91APP 自製了一個 Queue System 的底層，團隊只要依據規定的介面與 API 接口進行開發，交付 Artifact 後透過設定的方式即可將新的 Worker 掛入底層，並接上設定的 Queue 開始運作</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/cc1de813de346e73abbddb42daef6efd/a3bed/9.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 40.49079754601227%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABHklEQVQY05WQUUvDMBSF9/9/yQRBRHwQURjo6rqu3VYKznZdbbNMtGvSrWmWJrk1bjIHguDhcDkP5+PA7bT/F6U0z3MTOn+UdPWuilSTTBAkSQplpsirKpd4mWGMv2EwMvdoOKCNRF4ZTNYv9o0z/whtjQc86ctsAGKzb8AXLCitEarxqsbYBEHJHhYCjePhNA9HTjApIruyb+vQUtjVnP7ADV4x16t9nxm7Y4HSw/Iu9ab3o/XMGvh9+txj110R9to3B3h5ArOaF2RHKSfUBMlYC9Isb7JgEc2TeZwax3ESL+IoQdEMTpd/C7RuNUsW6dkjO7fYpb29GlYXT9vuQ3XnFtDwQ20PwykHx4+B5GpXGUu+lYJL2SgplFLH7icNZsS84Ao7VgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"9\"\n        title=\"9\"\n        src=\"/static/cc1de813de346e73abbddb42daef6efd/a6d36/9.png\"\n        srcset=\"/static/cc1de813de346e73abbddb42daef6efd/222b7/9.png 163w,\n/static/cc1de813de346e73abbddb42daef6efd/ff46a/9.png 325w,\n/static/cc1de813de346e73abbddb42daef6efd/a6d36/9.png 650w,\n/static/cc1de813de346e73abbddb42daef6efd/e548f/9.png 975w,\n/static/cc1de813de346e73abbddb42daef6efd/3c492/9.png 1300w,\n/static/cc1de813de346e73abbddb42daef6efd/a3bed/9.png 1721w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2 id=\"graceful-shutdown\" style=\"position:relative;\"><a href=\"#graceful-shutdown\" aria-label=\"graceful shutdown permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Graceful shutdown</h2>\n<p>前面有提到 SDK 內建 Graceful Shutdown，這讓我們的 Worker 在收到關機指令時，會暫停再跟 Queue 收新的任務來做事，並且確實的將手上的任務執行完畢並通知 Queue 後才將自己關機，有了這個機制使我們能更放心的更新、部署 Queue System，不再需要擔心會不會有任務做到一半掉了的問題</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c92dc18c9a190c8b2f8c4c1182b185b3/0bdcb/10.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50.306748466257666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABbElEQVQoz32Ra1OCQBSG+f//qKYZrEkzAYFVW+QitsAiGiWySyDu2daamj6UZ969fHnmeWeOJi8ONKXYebL0xA43qdMXc1ku5csT7IkEof1FwDnqPXWCThmxNyuceMi6H/jupIjxbu11xABWaP9LBbSVpCZdhzdGphvJnb0ZWJluZoZXsWQuK6IBgPg9UvZvb4LVEnroO0kt5Xmc5TYuJigdTWN1o+CVJTNZJZpCWRSxIKyDoJ4v3svXJoz6lJzdCs6tbeyNXGrh3SOit0Y0sokbVjX5ggGa5bLBHseY2U5bFCfOBa9/4Czyr8fPV8NAN5OBld5O6dAtvs0ALect4x3nHWNt0/TiJEUnxRH6d1V7u16OEbUW+RRvzXluLjbILxlBZ/jCmuDIv2rrk/jeWo9dOrKToU2c8PBZm2iXlnw6ns0xfkD5LNyjcD+LKhX1qZX5kF6E1dmvNuFCN4gT1E5wsD/j+FWd+bJvPgD+wyrrHYO5wgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"10\"\n        title=\"10\"\n        src=\"/static/c92dc18c9a190c8b2f8c4c1182b185b3/a6d36/10.png\"\n        srcset=\"/static/c92dc18c9a190c8b2f8c4c1182b185b3/222b7/10.png 163w,\n/static/c92dc18c9a190c8b2f8c4c1182b185b3/ff46a/10.png 325w,\n/static/c92dc18c9a190c8b2f8c4c1182b185b3/a6d36/10.png 650w,\n/static/c92dc18c9a190c8b2f8c4c1182b185b3/e548f/10.png 975w,\n/static/c92dc18c9a190c8b2f8c4c1182b185b3/3c492/10.png 1300w,\n/static/c92dc18c9a190c8b2f8c4c1182b185b3/0bdcb/10.png 1579w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2 id=\"對-queue-進行分群\" style=\"position:relative;\"><a href=\"#%E5%B0%8D-queue-%E9%80%B2%E8%A1%8C%E5%88%86%E7%BE%A4\" aria-label=\"對 queue 進行分群 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>對 Queue 進行分群</h2>\n<p>如果每個 Worker 都要搭配一條專屬的 Queue 來進行工作，公司有數百個 Worker 管理維運成本將變得很高，所以我們對 Queue 定義了 <strong>SLO (服務等級目標)</strong> 後做了適度的分群，對於 SLO 相同的 Worker 讓它使用同一條 Queue，並在底層自製了 Router (Process Pool) 來分配任務，它會依據工程師的設定有限度的自行擴展 Worker 執行任務，同時對於閒置太久的 Worker 也會對它進行關機來節省資源，這邊其實開發的方式並不太容易，有興趣的朋友可以參考敝司的首席架構師 Andrew 部落格 - <a href=\"https://columns.chicken-house.net/2020/02/09/process-pool/\">微服務基礎建設: Process Pool 的設計與應用</a>，裡面有詳盡的開發介紹。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/408a370583a74d5cd106f0385c8d9e57/9eaa0/11.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 35.58282208588957%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABXUlEQVQY021Qy07CUBDlb4yJH6E/YCIrd65x4da41Y0Lv8DEhJSiVKVWalABAcEHtDxCq4UiIBBDMdIXpO9e9FaJK04mJ5OZczKT4/ueh+nUY1UyaoUBSw3ox16XautlTqIbaqWhUJwkjKHAN8dpGMB2YMOWhjjSvIq0z4PsE/L8jmW58D2P5V+RdCnd8cwuAJZlmbKsaZqp6y5wzbemI0pwV31oB/dCxwencbQaI3t4VowmP/GcFEmJhdzH7LKrqk2/PxGLKfW6KmmKIAJdg/PiLb2zvLK7uoYf5uOJIUmb5N1XPMoTGF/M9mdmZzzuBAL5ZGrSaXX7E0EBf/8ztIAHa+TJyyXKRNDyUbiIouUbjCMQtpDpeWYAgGPbzi9cx9EM17RhXF5iLW50gdQItHJ9xm9v7S8tLG6sb2bIPhFiGGowP7B/AHeqiIY8MiArkqlKFmR5pMOybRcKfgBRTGpxutts2wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"11\"\n        title=\"11\"\n        src=\"/static/408a370583a74d5cd106f0385c8d9e57/a6d36/11.png\"\n        srcset=\"/static/408a370583a74d5cd106f0385c8d9e57/222b7/11.png 163w,\n/static/408a370583a74d5cd106f0385c8d9e57/ff46a/11.png 325w,\n/static/408a370583a74d5cd106f0385c8d9e57/a6d36/11.png 650w,\n/static/408a370583a74d5cd106f0385c8d9e57/e548f/11.png 975w,\n/static/408a370583a74d5cd106f0385c8d9e57/3c492/11.png 1300w,\n/static/408a370583a74d5cd106f0385c8d9e57/9eaa0/11.png 1676w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2 id=\"維運與監控\" style=\"position:relative;\"><a href=\"#%E7%B6%AD%E9%81%8B%E8%88%87%E7%9B%A3%E6%8E%A7\" aria-label=\"維運與監控 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>維運與監控</h2>\n<p>在探討怎麼維運與監控時必須得先問自己一個問題，<strong>我們究竟關心什麼？</strong> 對於 91APP 來說，我們關心 <strong>效率</strong>，所以對 Queue 都進行的 SLO 的定義，我們並不只是期待服務開發完上線來能跑就好，我們更希望它依照定義的目標與效率來執行，當服務沒達到水平時我們應該要被通知到並進一步修正與改善。</p>\n<p>所以我們開始定義關於效率的指標，以下圖為例，我們對每則進入 Queue 的 Message 都標上時間，當 Message 被取出時計算它延遲了多久，Router 將工作分配給 Worker 執行時也會計算總共花費了多少時間，透過這幾個時間點來了解 Message 整個生命週期耗費了多少時間</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/48ad0281e565b6505fd6479448dab159/a95f7/12.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 25.153374233128833%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAm0lEQVQY032PPQ7DIAyFuf8B2jMkR2nXrFmaDgwoCWkEwoBdGytR1KFPFrI/Pf9gCEmCBZnGkSpyibUK8Z5ekyQCkRROb5pnhUZoaXT1dLvzCBmlvmHArpNEDQ1i39PjqcsMXaQXhBCWdam1nCcAgN82jpTSaWOZayeWwm7nnLV2/+zEJQC/BXIMIcXICfLvEH+bjxmYm6pe/ldfb3skpBOY/PIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"12\"\n        title=\"12\"\n        src=\"/static/48ad0281e565b6505fd6479448dab159/a6d36/12.png\"\n        srcset=\"/static/48ad0281e565b6505fd6479448dab159/222b7/12.png 163w,\n/static/48ad0281e565b6505fd6479448dab159/ff46a/12.png 325w,\n/static/48ad0281e565b6505fd6479448dab159/a6d36/12.png 650w,\n/static/48ad0281e565b6505fd6479448dab159/e548f/12.png 975w,\n/static/48ad0281e565b6505fd6479448dab159/3c492/12.png 1300w,\n/static/48ad0281e565b6505fd6479448dab159/a95f7/12.png 1853w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>有了這些數據搭配前面提到的串接 CloudWatch，我們可以得到下面這張圖，並且透過這張圖來了解 Queue 的狀況，這分鐘每筆 Message 執行的效率如何，整體是否有延遲<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3381d4456c847dba29e38748ff691237/5f7fb/13.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 38.65030674846626%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA+ElEQVQY04VQi27DIAzM/3/hNqlblTZNC+FpXuaVkVBFUzdpJyTs852NGay1iLj+h5SLw4yppB0hoAthaIX6F3LJtZZW6+UtWOvRS2jlvR/Kjhdnk/nkf/MHyta6Pif/fGFPAF1pk3fEkmKJda0vu3TzJoo5NfVhEBZSyTuTIRjtIaTQ+LZ4DzZzLEiBOQzUSAIsZsScAO0CvJGL5dyKM72O7H5mU8rRBqeDfppnSU/kuoC6LI/3eWwp0XxcyIlMs2Sf9PZF7x/zNFLydrvcFRs5mSXpKwzaOqlBQrudNEZorcAY58FavvFGWedDch7bEQBCKQnQv+kbDGDRzpd+c9wAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"13\"\n        title=\"13\"\n        src=\"/static/3381d4456c847dba29e38748ff691237/a6d36/13.png\"\n        srcset=\"/static/3381d4456c847dba29e38748ff691237/222b7/13.png 163w,\n/static/3381d4456c847dba29e38748ff691237/ff46a/13.png 325w,\n/static/3381d4456c847dba29e38748ff691237/a6d36/13.png 650w,\n/static/3381d4456c847dba29e38748ff691237/e548f/13.png 975w,\n/static/3381d4456c847dba29e38748ff691237/3c492/13.png 1300w,\n/static/3381d4456c847dba29e38748ff691237/5f7fb/13.png 1889w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>同時也收集每條 Queue 每分鐘收到 / 消化的 Message 總量，有沒有哪些 Message 違反了我們所定義的 SLO</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7627d37eceab895bd54f8089a9bdb68c/ec5f6/14.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 39.263803680981596%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAApUlEQVQY03VQixLDIAjz/7+2typVeXRBtLutK5fDiEDAxMyllN77+WxmBs9qjZUBERamWpMM0/H8VKmmTk4Qi0YH5YpiW2Ur/rmN8xST0su9JZwrR94oNlW1xWfEtEnTqTotOiTP/lb80YCyr2ly3yjZ87bX2JD9X6wu7Rj/MTlSA9CMmUFsvcb/TWWqVI4Sfqc9HxkAedFr2zcEW2tXQqYMiPogb0BW2jH3jK7QAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"14\"\n        title=\"14\"\n        src=\"/static/7627d37eceab895bd54f8089a9bdb68c/a6d36/14.png\"\n        srcset=\"/static/7627d37eceab895bd54f8089a9bdb68c/222b7/14.png 163w,\n/static/7627d37eceab895bd54f8089a9bdb68c/ff46a/14.png 325w,\n/static/7627d37eceab895bd54f8089a9bdb68c/a6d36/14.png 650w,\n/static/7627d37eceab895bd54f8089a9bdb68c/e548f/14.png 975w,\n/static/7627d37eceab895bd54f8089a9bdb68c/3c492/14.png 1300w,\n/static/7627d37eceab895bd54f8089a9bdb68c/ec5f6/14.png 1852w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>搭配監控機器的 CPU 、Memory、Disk I/O 狀況，當有問題發生時我們可以更快的分辨出究竟延遲是機器太忙，還是外部服務變慢導致的現象</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1b7388fc0be8040c5d9ebce2a29ff375/0a344/15.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 25.153374233128833%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAtklEQVQY0z2PWQ7DIAxEc/9TVulHlZCEzWwGkw5E7QgQ4HmWZ2mtFYi5idxT/ScRYeZaK07YUOJ5x49M8wLwUGpf33ScrbbHBw49YNqnPtt2XheFYJwPMfLUgOFIMXSrqz6FS06mJJ+iLzmii9Y6OEcgrSGy+lLeeWs0qAFLE2N05lBqQmuRQhQwHUg4nPd+3/O2qfWVog3kyDnOWWaKBdmQVsbGj/Q57T/zU+33PVJKn2s8n9IXHz8i7L7tqpUAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"15\"\n        title=\"15\"\n        src=\"/static/1b7388fc0be8040c5d9ebce2a29ff375/a6d36/15.png\"\n        srcset=\"/static/1b7388fc0be8040c5d9ebce2a29ff375/222b7/15.png 163w,\n/static/1b7388fc0be8040c5d9ebce2a29ff375/ff46a/15.png 325w,\n/static/1b7388fc0be8040c5d9ebce2a29ff375/a6d36/15.png 650w,\n/static/1b7388fc0be8040c5d9ebce2a29ff375/e548f/15.png 975w,\n/static/1b7388fc0be8040c5d9ebce2a29ff375/3c492/15.png 1300w,\n/static/1b7388fc0be8040c5d9ebce2a29ff375/0a344/15.png 1741w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>每種任務的特性可能都不太一樣，有些量不大但對於時間的敏感度較高，例如：簡訊，它可能瞬間只會有幾千筆，卻必須要在 5 秒內送到客戶手中，有了前述這些監控指標與數據，使我們能更容易抓出系統的瓶頸點，進而有機會優化。</p>\n<p>圖中紅點是該分鐘違反 SLO 的 Message 數量，搭配 CloudWatch Alarm 與 Slack API 串接，能更即時的讓 RD 知道目前發生了什麼狀況，並且做出即時的處理。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/fac6089c6dec86c9b55491fa4fbe9346/58354/16.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 37.423312883435585%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAuUlEQVQY042Q3QqDMAyFff9n80bwRhA25xxubcW1tknXH5cq7mIT2QmUhPDRc5LNm4wxnAvSNOn5P2WfDgCMAeec957GSLUpxHDnNz3pEMI+TAuwgB4TGRPpg5+Xhl4lmJQSEXfguFQt6rzPq6FqZds8G64Z06xTHTo8sr3CnexKXo449rpv5OUkzwUrSlbS+BXk1zaFdeDM6nm2L8ceBlVMIeLhz2kfiU5Ho8shwCBse7VKI1qqXfgNMf2Zs11DqhIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"16\"\n        title=\"16\"\n        src=\"/static/fac6089c6dec86c9b55491fa4fbe9346/a6d36/16.png\"\n        srcset=\"/static/fac6089c6dec86c9b55491fa4fbe9346/222b7/16.png 163w,\n/static/fac6089c6dec86c9b55491fa4fbe9346/ff46a/16.png 325w,\n/static/fac6089c6dec86c9b55491fa4fbe9346/a6d36/16.png 650w,\n/static/fac6089c6dec86c9b55491fa4fbe9346/e548f/16.png 975w,\n/static/fac6089c6dec86c9b55491fa4fbe9346/3c492/16.png 1300w,\n/static/fac6089c6dec86c9b55491fa4fbe9346/58354/16.png 1396w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8edf44fa55e99c2fde959f3be1f57dd0/7d920/17.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 47.239263803680984%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABfElEQVQoz2WQWU/CQBSF/QkmSlyg0J3WWgplNbK002WmoK/GJ6PBmPgPFAV9MwKKxvik8ZdC8IAJQU1O7szp3O/O6axMJpPpdPo+eqN+1L64PGufn54cHR8dkoBW66TW8KBqg8wE63iOF9qFysfnF6iV8XiM5bpzy/GyT1vVuuuRCnHKll207JKVK5rZQq5QyeSK2Xx518obGXt1bePhcbAE33STgkKjQ9dndZc6HiM+C9lBwFquR1E9GqHu11wM2oynhk+jP7DKmoCpTyPU2RQSNCA3gMUGU8LogATMtPLPL6/LcI/nBS9kdnEP2SR1R04boqIrmonAsAupuhnb4vrDpyX49k4S4mo6Hef4lKgKsg6SlzW07teJou3CQoKsYR/bTPyCr256isSxqFlzfABo+umWVF03zO1EkkuJuHae5T/c6Skix5otVc/Mb9YgXkoDwPtn7VJKVBAHH/E76xvx/mAJ7nTvNVXwg1AzsjjG+IUQBFpYzbAWr/0Npay8HFRLPMMAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"17\"\n        title=\"17\"\n        src=\"/static/8edf44fa55e99c2fde959f3be1f57dd0/a6d36/17.png\"\n        srcset=\"/static/8edf44fa55e99c2fde959f3be1f57dd0/222b7/17.png 163w,\n/static/8edf44fa55e99c2fde959f3be1f57dd0/ff46a/17.png 325w,\n/static/8edf44fa55e99c2fde959f3be1f57dd0/a6d36/17.png 650w,\n/static/8edf44fa55e99c2fde959f3be1f57dd0/e548f/17.png 975w,\n/static/8edf44fa55e99c2fde959f3be1f57dd0/3c492/17.png 1300w,\n/static/8edf44fa55e99c2fde959f3be1f57dd0/7d920/17.png 1655w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<hr>\n<h1 id=\"結語\" style=\"position:relative;\"><a href=\"#%E7%B5%90%E8%AA%9E\" aria-label=\"結語 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>結語</h1>\n<p>Queue 是一個很好用且成熟的工具，它可以幫助我們應付 <strong>瞬間巨量</strong>、<strong>系統間解耦</strong>，但隨著服務的擴展與規模的變大，往往維運成本就會漸漸變高，隨時問問自己究竟關心什麼？想辦法讓這些關注點數據化，透過一些成熟的工具，例如：CloudWatch、Slack、Container... 等等，將有機會大幅度的降低維運成本。</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n</style>","tableOfContents":"<ul>\n<li><a href=\"#%E4%BB%80%E9%BA%BC%E6%98%AF-queue%EF%BC%9F\">什麼是 Queue？</a></li>\n<li>\n<p><a href=\"#queue-%E9%81%A9%E5%90%88%E7%9A%84%E4%BD%BF%E7%94%A8%E5%A0%B4%E6%99%AF\">Queue 適合的使用場景</a></p>\n<ul>\n<li><a href=\"#1%E9%9D%9E%E5%90%8C%E6%AD%A5%E8%99%95%E7%90%86\">1.非同步處理</a></li>\n<li><a href=\"#2%E6%87%89%E4%BB%98%E7%9E%AC%E9%96%93%E5%B7%A8%E9%87%8F\">2.應付瞬間巨量</a></li>\n<li><a href=\"#3%E7%B3%BB%E7%B5%B1%E9%96%93%E8%A7%A3%E8%80%A6\">3.系統間解耦</a></li>\n<li><a href=\"#%E6%AF%94%E8%BC%83-queue-%E8%88%87-load-balancer-%E7%9A%84%E5%B7%AE%E7%95%B0\">比較 Queue 與 Load Balancer 的差異</a></li>\n<li><a href=\"#%E6%8C%91%E6%88%B0\">挑戰</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#91app-%E6%80%8E%E9%BA%BC%E5%81%9A%EF%BC%9F\">91APP 怎麼做？</a></p>\n<ul>\n<li><a href=\"#messageworker-sdk-%E8%A3%BD%E4%BD%9C\">MessageWorker SDK 製作</a></li>\n<li><a href=\"#%E8%AE%93%E5%9C%98%E9%9A%8A%E5%B0%88%E6%B3%A8%E6%96%BC%E5%95%86%E6%A5%AD%E9%82%8F%E8%BC%AF%E9%96%8B%E7%99%BC\">讓團隊專注於商業邏輯開發</a></li>\n<li><a href=\"#graceful-shutdown\">Graceful shutdown</a></li>\n<li><a href=\"#%E5%B0%8D-queue-%E9%80%B2%E8%A1%8C%E5%88%86%E7%BE%A4\">對 Queue 進行分群</a></li>\n<li><a href=\"#%E7%B6%AD%E9%81%8B%E8%88%87%E7%9B%A3%E6%8E%A7\">維運與監控</a></li>\n</ul>\n</li>\n<li><a href=\"#%E7%B5%90%E8%AA%9E\">結語</a></li>\n</ul>","frontmatter":{"date":"2020/06/24","title":"91APP Queue System 解密","category":"Architecture","tags":["Message Queue","Graceful Shutdown"],"author":"Steven Tsai","authorPhoto":{"childImageSharp":{"fluid":{"src":"/static/a531b309792e5850050459827e8bfd2d/0f3a1/steven-tsai.jpg","originalName":"steven-tsai.jpg"}}},"bannerPhoto":{"childImageSharp":{"fluid":{"src":"/static/2818e3548dee8b55068f15123b1edec2/ee604/1.png","originalName":"1.png"}}},"youtubePath":"https://www.youtube.com/watch?v=E1pxP0wuGso"},"fields":{"slug":"blog/Architecture/91app-queue-system"}}},"pageContext":{"slug":"blog/Architecture/91app-queue-system"}},"staticQueryHashes":["1351831723","63159454"]}